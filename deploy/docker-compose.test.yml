version: "3.9"
services:

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    ports:
      - "17000:17000"
    environment:
      MONGODB_URI: "mongodb://mongodb:27018"
      MONGODB_NAME: "ani"
      NODE_ENV: "development"
      PORT: "17000"
      CORS_WHITELIST: "http://localhost:3000,http://localhost:17000,http://backend"

  mongodb:
    image: mongo:6.0.24
    ports:
      - "27018:27018"
    volumes:
      - mongodb_data:/data/db
    environment:
      - MONGO_INITDB_DATABASE=ani
    command: [ "mongod", "--port", "27018" ]
    restart: always

  mongo-seed:
    image: mongo:6.0.24
    volumes:
      - ./db/mongo/dump:/dump
    entrypoint: [ "sh", "-c", "sleep 5 && mongorestore --host mongodb --port 27018 --db ani /dump/ani" ]

  nginx:
    build:
      context: .
      dockerfile: ./nginx/Dockerfile.dev
    depends_on:
      - backend
    ports:
      - "3000:3000"
