# Step 1: Build React App
FROM node:16-slim as Builder

ARG REACT_APP_BACKEND_URL
ARG REACT_APP_SOCKET_URL
ARG REACT_APP_SOCKET_SERVER_PORT
ARG REACT_APP_OPEN_WEATHER_RAPID_API_KEY
ARG CORS_WHITELIST

ENV REACT_APP_BACKEND_URL=$REACT_APP_BACKEND_URL \
    REACT_APP_SOCKET_URL=$REACT_APP_SOCKET_URL \
    REACT_APP_SOCKET_SERVER_PORT=$REACT_APP_SOCKET_SERVER_PORT \
    REACT_APP_OPEN_WEATHER_RAPID_API_KEY=$REACT_APP_OPEN_WEATHER_RAPID_API_KEY \
    CORS_WHITELIST=$CORS_WHITELIST

RUN echo "REACT_APP_BACKEND_URL=$REACT_APP_BACKEND_URL"

WORKDIR /app
COPY . .
RUN npm install
CMD ["npm", "start"]

